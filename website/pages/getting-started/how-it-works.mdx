import { Callout } from 'nextra/components'

# How It Works

HeySummon is a relay platform that connects AI agents to human experts in real time.

---

## Request lifecycle

```
pending  â†’  reviewing  â†’  responded
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  expired  (after TTL, default 72h)
                         â†’  closed    (manually via API)
```

| Status | Meaning |
|--------|---------|
| `pending` | Submitted, waiting for a human to open it |
| `reviewing` | Human has opened the request in the dashboard |
| `responded` | Human has replied |
| `expired` | TTL elapsed (default 72 hours) |
| `closed` | Manually closed via `/api/v1/close/:id` |

---

## Full flow

```
AI Agent
  â”‚
  â”‚  POST /api/v1/help
  â”‚  { apiKey, question (encrypted), signPublicKey, encryptPublicKey }
  â–¼
Guard
  â”‚  Validates x-api-key
  â”‚  Inspects content: XSS, PII, malicious URLs
  â”‚  Adds X-Guard-Receipt (Ed25519 signature)
  â–¼
Platform
  â”‚  Verifies Guard receipt
  â”‚  Generates ref code: HS-XXXXXXXX
  â”‚  Stores encrypted request
  â”‚  Publishes Mercure event â†’ provider topic
  â–¼
Mercure â”€â”€SSEâ”€â”€â–¶ Provider dashboard / watcher
                       â”‚
                       â”‚  Notification: "ðŸ¦ž [HS-XXXXXXXX] New request"
                       â”‚  Human reads, responds
                       â–¼
                   Platform
                       â”‚  Status â†’ responded
                       â”‚  Publishes Mercure event â†’ consumer topic
                       â–¼
                   AI Agent (polling or SSE)
                       â”‚  GET /api/v1/help/:id â†’ { status: "responded" }
```

---

## Reference codes

Every request gets an `HS-XXXXXXXX` code (8 alphanumeric characters).

These codes are:
- Shown in the dashboard and notifications
- Used to reply from a messaging app: `[HS-A1B2C3D4] Yes, proceed`
- Included in audit logs for traceability

---

## Real-time vs polling

| Method | How | Latency |
|--------|-----|---------|
| **SSE stream** | `GET /api/v1/events/stream` â€” persistent connection | Instant |
| **Polling** | `GET /api/v1/help/:id` â€” check every N seconds | N seconds |

Use SSE for production agents. Polling is simpler for scripts and one-off requests.

---

## Multi-turn conversations

Requests support back-and-forth messages. After the initial response, the agent can send follow-up questions using `POST /api/v1/message/:requestId`. Each message gets a Mercure notification.

All messages in a conversation share the same `HS-XXXXXXXX` ref code.

---

## Guard proxy

All requests flow through the **Guard proxy** before reaching the platform:

- Validates the API key
- Scans for malicious content: XSS, HTML injection, PII (credit cards, SSNs, BSNs)
- Defangs suspicious URLs
- Signs the request with Ed25519 â€” platform rejects anything that bypassed Guard

See [Security â†’ Content Safety Guard](/security/content-safety-guard) for details.
